/**
 * @package SP Page Builder
 * @author JoomShaper http://www.joomshaper.com
 * @copyright Copyright (c) 2010 - 2022 JoomShaper
 * @license http://www.gnu.org/licenses/gpl-2.0.html GNU/GPLv2 or later
 */
!function(e){var a,d;e(document).on("click",".sp-pagebuilder-btn-media-manager",(function(a){a.preventDefault(),$this=e(this),e.ajax({type:"POST",url:pagebuilder_base+"index.php?option=com_sppagebuilder&view=media&layout=modal&format=json",data:{support:$this.attr("data-support"),type:$this.attr("data-support"),target:$this.prev().attr("id")},beforeSend:function(){$this.find(".fa").show()},success:function(a){$this.find(".fa").hide(),e(a).show().appendTo(e("body").addClass("sp-pagebuilder-media-modal-open"))}})})),e(document).on("click",".sp-pagebuilder-btn-close-modal",(function(a){a.preventDefault(),e(".sp-pagebuilder-media-modal-overlay").remove(),e("body").removeClass("sp-pagebuilder-media-modal-open")})),e.fn.browseMedia=function(a){a=e.extend({type:"*",search:"",date:"",start:0,filter:!0,categories:!1,support:"image"},a);e.ajax({type:"POST",url:pagebuilder_base+"index.php?option=com_sppagebuilder&view=media&layout=browse&format=json",data:{type:a.type,date:a.date,start:a.start,search:a.search,categories:a.categories,support:a.support},beforeSend:function(){e("#sp-pagebuilder-media-manager, #sp-pagebuilder-media-modal").removeClass("sp-pagebuilder-media-manager-empty"),e("#sp-pagebuilder-delete-media").attr("disabled","disabled"),e("#sp-pagebuilder-media-loadmore").hide(),e(".sp-pagebuilder-media").remove()},success:function(d){var i=e.parseJSON(d),t=e("#sp-pagebuilder-media-types").find(".active");t.find("i").removeClass().addClass(t.find(">a").data("icon-name")),a.filter&&e("#sp-pagebuilder-media-filter").html(i.date_filter).removeAttr().attr("data-type","browse"),a.categories&&(e("#sp-pagebuilder-media-types").html(i.media_categories),a.support&&(e("#sp-pagebuilder-media-types").find(">li").removeClass("active"),e("#sp-pagebuilder-media-types").find(".sp-pagebuilder-media-type-"+a.support).addClass("active"))),i.count?e("#sp-pagebuilder-media-manager, #sp-pagebuilder-media-modal").removeClass("sp-pagebuilder-media-manager-empty"):e("#sp-pagebuilder-media-manager, #sp-pagebuilder-media-modal").addClass("sp-pagebuilder-media-manager-empty"),e(".sp-pagebuilder-media-wrapper").prepend(i.output),i.loadmore?e("#sp-pagebuilder-media-loadmore").removeAttr("style"):e("#sp-pagebuilder-media-loadmore").hide()}})},e.fn.browseFolders=function(a){a=e.extend({path:sppbMediaPath,filter:!0},a);return this.each((function(){e.ajax({url:pagebuilder_base+"index.php?option=com_sppagebuilder&view=media&layout=folders&format=json",type:"POST",data:{path:a.path},beforeSend:function(){e("#sp-pagebuilder-media-manager, #sp-pagebuilder-media-modal").removeClass("sp-pagebuilder-media-manager-empty"),a.filter&&e("#sp-pagebuilder-media-filter").removeAttr().attr("data-type","folders").val(a.path).parent().show(),e("#sp-pagebuilder-delete-media").attr("disabled","disabled"),e("#sp-pagebuilder-media-loadmore").hide(),e(".sp-pagebuilder-media").remove()},success:function(d){var i=e("#sp-pagebuilder-media-types").find(".active");i.find("i").removeClass().addClass(i.find(">a").data("icon-name"));var t=e.parseJSON(d);0!=t.status?(t.count?e("#sp-pagebuilder-media-manager, #sp-pagebuilder-media-modal").removeClass("sp-pagebuilder-media-manager-empty"):e("#sp-pagebuilder-media-manager, #sp-pagebuilder-media-modal").addClass("sp-pagebuilder-media-manager-empty"),a.filter&&e("#sp-pagebuilder-media-filter").html(t.folders_tree).removeAttr().attr("data-type","folders"),e(".sp-pagebuilder-media-wrapper").prepend(t.output)):alert(t.message)}})}))},e(document).on("click",".sp-pagebuilder-media-to-folder-back",(function(a){a.preventDefault(),e(".sp-pagebuilder-media-btn-tools").hide(),e(this).browseFolders({path:e(this).data("path")})})),e(document).on("click",".sp-pagebuilder-media-to-folder",(function(a){a.preventDefault(),e(".sp-pagebuilder-media").find(">li.sp-pagebuilder-media-item").removeClass("selected"),e(".sp-pagebuilder-media").find(">li.sp-pagebuilder-media-folder").removeClass("folder-selected"),e(this).closest("li.sp-pagebuilder-media-folder").addClass("folder-selected")})),e(document).on("dblclick",".sp-pagebuilder-media-to-folder",(function(a){a.preventDefault(),e(".sp-pagebuilder-media-btn-tools").hide(),e(this).browseFolders({path:e(this).attr("data-path")})})),e.fn.uploadMedia=function(a){a=e.extend({index:"",data:""},a);e.ajax({type:"POST",url:pagebuilder_base+"index.php?option=com_sppagebuilder&task=media.upload_media",data:a.data,contentType:!1,cache:!1,processData:!1,beforeSend:function(){var d=e(".sp-pagebuilder-media").find(".sp-pagebuilder-media-folder:not(.sp-pagebuilder-media-to-folder-back)"),i=e(".sp-pagebuilder-media").find(".sp-pagebuilder-media-to-folder-back"),t=e('<li id="'+a.index+'" class="sp-pagebuilder-media-file-loader"><div class="sp-pagebuilder-media-item-image"><div class="sp-pagebuilder-media-title"><i class="fas fa-circle-notch fa-spin fa-spin"></i> '+Joomla.JText._("COM_SPPAGEBUILDER_MEDIA_MANAGER_MEDIA_UPLOADING")+'...</div><div class="sp-pagebuilder-media-item-uploading"><div class="sp-pagebuilder-progress"><div class="sp-pagebuilder-progress-bar" style="width: 0%;"></div></div></div></div></li>');d.length?d.last().after(t):i.length?i.first().after(t):e(".sp-pagebuilder-media").prepend(t),e("#sp-pagebuilder-media-manager, #sp-pagebuilder-media-modal").removeClass("sp-pagebuilder-media-manager-empty")},success:function(d){var i=e.parseJSON(d);i.status?(e(".sp-pagebuilder-media").find("#"+a.index).removeAttr("id").removeClass('sp-pagebuilder-media-file-loader"').addClass("sp-pagebuilder-media-item").attr("data-id",i.id).attr("data-src",i.src).attr("data-path",i.path).empty().html(i.output),e(".sp-pagebuilder-browse-image span").html(i.total_row),e(".sp-pagebuilder-browse-all span").html(i.total_row)):(e(".sp-pagebuilder-media").find("#"+a.index).remove(),alert(i.output)),e(".sp-pagebuilder-media").find(">li").length?e("#sp-pagebuilder-media-manager, #sp-pagebuilder-media-modal").removeClass("sp-pagebuilder-media-manager-empty"):e("#sp-pagebuilder-media-manager, #sp-pagebuilder-media-modal").addClass("sp-pagebuilder-media-manager-empty")},xhr:function(){return myXhr=e.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",(function(d){e(".sp-pagebuilder-media").find("#"+a.index).find(".sp-pagebuilder-progress-bar").css("width",Math.floor(d.loaded/d.total*100)+"%").text(Math.floor(d.loaded/d.total*100)+"%")}),!1),myXhr}})},e(document).on("keyup","#sp-pagebuilder-media-search-input",(function(i){if(i.preventDefault(),""!=e(this).val()?e(".sp-pagebuilder-clear-search").show():e(".sp-pagebuilder-clear-search").hide(),e(this).val()!=a){var t=e(this).val().trim();d&&clearTimeout(d),d=setTimeout((function(){t?e(this).browseMedia({search:t,filter:!0,date:e("#sp-pagebuilder-media-filter").val(),type:e("#sp-pagebuilder-media-types").find(".active > a").attr("data-type"),support:"all"}):e(this).browseMedia({filter:!0,date:e("#sp-pagebuilder-media-filter").val(),type:e("#sp-pagebuilder-media-types").find(".active > a").attr("data-type"),support:"all"})}),300),a=e(this).val()}})),e(document).on("click",".sp-pagebuilder-clear-search",(function(a){a.preventDefault(),e("#sp-pagebuilder-media-search-input").val("").focus().keyup()})),e(document).on("click","#sp-pagebuilder-media-search-input",(function(e){e.preventDefault()})),e(document).on("click",".sp-pagebuilder-browse-media",(function(a){a.preventDefault();var d=e(this);if(e(this).closest("#sp-pagebuilder-media-types").children().removeClass("active"),e(this).parent().addClass("active"),e(this).find("i").removeClass().addClass("fas fa-spinner fa-spin fa-fw"),"folders"==d.attr("data-type"))e(".sp-pagebuilder-media-search").parent().hide(),d.data("joomla3")?e("#sp-pagebuilder-media-create-folder").removeClass("d-none"):e("#sp-pagebuilder-media-create-folder").parent().removeClass("d-none"),e(this).browseFolders();else{e(".sp-pagebuilder-media-search").parent().show(),d.data("joomla3")?e("#sp-pagebuilder-media-create-folder").parent().addClass("d-none"):e("#sp-pagebuilder-media-create-folder").addClass("d-none");var i="all";e("#sp-pagebuilder-media-modal").length&&(i=e("#sp-pagebuilder-media-modal").data("support")),e(this).browseMedia({type:d.data("type"),support:i,element:d})}})),e(document).on("click","#sp-pagebuilder-media-loadmore",(function(a){a.preventDefault();var d=e(this),i=e("#sp-pagebuilder-media-search-input").val().trim(),t="all";e("#sp-pagebuilder-media-modal").length&&(t=e("#sp-pagebuilder-media-modal").data("support")),e.ajax({type:"POST",url:pagebuilder_base+"index.php?option=com_sppagebuilder&view=media&layout=browse&format=json",data:{search:i,type:e("#sp-pagebuilder-media-types").find(".active > a").attr("data-type"),support:t,date:e("#sp-pagebuilder-media-filter").val(),start:e(".sp-pagebuilder-media").find(">li").length},beforeSend:function(){d.find(".fa").removeClass("fa-refresh").addClass("fa-spinner fa-spin")},success:function(a){try{var i=e.parseJSON(a);d.find(".fa").removeClass("fa-spinner fa-spin").addClass("fa-refresh"),e(".sp-pagebuilder-media").append(i.output),i.loadmore?e("#sp-pagebuilder-media-loadmore").parent().removeAttr("style"):e("#sp-pagebuilder-media-loadmore").parent().hide()}catch(d){e(".sp-pagebuilder-media-body-inner").html(a)}}})})),e(document).on("change","#sp-pagebuilder-media-filter",(function(a){a.preventDefault(),"folders"==e(this).attr("data-type")?e(this).browseFolders({path:e(this).val()}):e(this).browseMedia({filter:!1,date:e(this).val(),type:e("#sp-pagebuilder-media-types").find(".active > a").attr("data-type"),support:"all"})})),e(document).on("click",".sp-pagebuilder-media > li.sp-pagebuilder-media-item",(function(a){a.preventDefault();var d=e(this);e(".sp-pagebuilder-media").find(">li.sp-pagebuilder-media-folder").removeClass("folder-selected"),d.hasClass("sp-pagebuilder-media-unsupported")||(null!=e("#sp-pagebuilder-media-modal")&&e("#sp-pagebuilder-media-modal .sp-pagebuilder-media > li.sp-pagebuilder-media-item").not(this).each((function(){e(this).removeClass("selected")})),e(this).hasClass("selected")?e(this).removeClass("selected"):e(this).addClass("selected"),e(".sp-pagebuilder-media > li.sp-pagebuilder-media-item.selected").length?e("#sp-pagebuilder-delete-media").removeAttr("disabled"):e("#sp-pagebuilder-delete-media").attr("disabled","disabled"))})),e(document).on("click","#sp-pagebuilder-insert-media",(function(a){a.preventDefault();var d=e("#sp-pagebuilder-media-modal").attr("data-support"),i=e("#"+e("#sp-pagebuilder-media-modal").attr("data-target"));"image"==d&&i.prev(".sp-pagebuilder-media-preview").removeClass("sp-pagebuilder-media-no-image").attr("src",e(".sp-pagebuilder-media > li.sp-pagebuilder-media-item.selected").data("src")),i.val(e(".sp-pagebuilder-media > li.sp-pagebuilder-media-item.selected").data("path")),i.trigger("change"),e(".sp-pagebuilder-media-modal-overlay").remove(),e("body").removeClass("sp-pagebuilder-media-modal-open")})),e(document).on("click",".sp-pagebuilder-btn-clear-media",(function(a){a.preventDefault();var d=e(this);d.siblings(".sp-pagebuilder-media-preview").addClass("sp-pagebuilder-media-no-image").removeAttr("src"),d.siblings("input").val(""),d.siblings("input").trigger("change")})),e(document).on("click","#sp-pagebuilder-upload-media, #sp-pagebuilder-upload-media-empty",(function(a){a.preventDefault(),e("#sp-pagebuilder-media-input-file").click()})),e(document).on("change","#sp-pagebuilder-media-input-file",(function(a){a.preventDefault();var d=e(this),i=e(this).prop("files"),t=new FormData,p=0;for(p=0;p<i.length;p++)t.append("file",i[p]),"folders"==e("#sp-pagebuilder-media-filter").attr("data-type")&&null!=e("#sp-pagebuilder-media-filter").val()&&t.append("folder",e("#sp-pagebuilder-media-filter").val()),e(this).uploadMedia({data:t,index:"media-id-"+Math.floor(1e6*Math.random()+1)});d.val("")})),e(document).on("dragenter","#sp-pagebuilder-media-manager",(function(a){a.preventDefault(),a.stopPropagation(),e(this).addClass("sp-pagebuilder-media-drop")})),e(document).on("mouseleave","#sp-pagebuilder-media-manager",(function(a){a.preventDefault(),a.stopPropagation(),e(this).removeClass("sp-pagebuilder-media-drop")})),e(document).on("dragover","#sp-pagebuilder-media-manager",(function(e){e.preventDefault()})),e(document).on("drop","#sp-pagebuilder-media-manager",(function(a){a.preventDefault(),a.stopPropagation(),e(this).removeClass("sp-pagebuilder-media-drop");var d=a.originalEvent.dataTransfer.files,i=0;for(i=0;i<d.length;i++){var t=new FormData;t.append("file",d[i]),"folders"==e("#sp-pagebuilder-media-filter").attr("data-type")&&null!=e("#sp-pagebuilder-media-filter").val()&&t.append("folder",e("#sp-pagebuilder-media-filter").val()),e(this).uploadMedia({data:t,index:"media-id-"+Math.floor(1e6*Math.random()+1)})}})),e(document).on("click","#sp-pagebuilder-delete-media",(function(a){a.preventDefault();e(this);var d=e(".sp-pagebuilder-media").find("li.sp-pagebuilder-media-item.selected");1==confirm(Joomla.JText._("COM_SPPAGEBUILDER_MEDIA_MANAGER_CONFIRM_DELETE"))&&d.each((function(a,i){var t={};t=void 0!==e(i).data("id")?{m_type:"id",id:e(i).data("id")}:{m_type:"path",path:e(i).data("path")},e.ajax({type:"POST",url:pagebuilder_base+"index.php?option=com_sppagebuilder&task=media.delete_media",data:t,success:function(a){var i=e.parseJSON(a);i.status?(d.remove(),e("#sp-pagebuilder-delete-media").attr("disabled","disabled"),e(".sp-pagebuilder-browse-image span").html(i.total_row),e(".sp-pagebuilder-browse-all span").html(i.total_row)):alert(i.output)}})}))})),e(document).on("click","#sp-pagebuilder-media-create-folder",(function(a){a.preventDefault();e(this);var d="/"+sppbMediaPath;null!=e("#sp-pagebuilder-media-filter").val()&&"folders"==e("#sp-pagebuilder-media-filter").attr("data-type")&&(d=e("#sp-pagebuilder-media-filter").val());var i=prompt(Joomla.JText._("COM_SPPAGEBUILDER_MEDIA_MANAGER_ENTER_DIRECTORY_NAME"));null!=i&&e.ajax({type:"POST",url:pagebuilder_base+"index.php?option=com_sppagebuilder&task=media.create_folder",data:{folder:d+"/"+i},success:function(a){try{var d=e.parseJSON(a);if(d.status){var i=e(".sp-pagebuilder-media").find(".sp-pagebuilder-media-folder"),t='<li class="sp-pagebuilder-media-folder sp-pagebuilder-media-to-folder" data-path="'+d.output.relname+'"><div class="sp-pagebuilder-media-item-directory"><div class="sp-pagebuilder-media-title">'+d.output.name+'</div><div class="sp-pagebuilder-media-item-preview"><i class="fas fa-folder" area-hidden="true"></i></div></div></li>';i.length?i.first().before(t):e(".sp-pagebuilder-media").append(t)}else alert(d.output)}catch(d){e(".sp-pagebuilder-media-body-inner").html(a)}}})}))}(jQuery);