/**
 * @package Helix Ultimate Framework
 * @author JoomShaper https://www.joomshaper.com
 * @copyright Copyright (c) 2010 - 2021 JoomShaper
 * @license http://www.gnu.org/licenses/gpl-2.0.html GNU/GPLv2 or Later
*/
jQuery((function(a){a(document).ready((function(){var e,t=a("#myTabTabs").find(">li").first();a('a[href="#attrib-helix_ultimate_blog_options"]').parent().insertAfter(t),(e=a("#jform_attribs_helix_ultimate_article_format label.active")).length>0&&e.click()})),a(".hu-image-field").each((function(e,t){var i=a(t);i.find(".btn-hu-image-upload").on("click",(function(a){a.preventDefault(),i.find(".hu-image-upload").click()})),i.find(".hu-image-upload").on("change",(function(e){e.preventDefault();var t=a(this),l=a(this).prop("files")[0],r=new FormData;r.append("option","com_ajax"),r.append("helix","ultimate"),r.append("request","task"),r.append("action","upload-blog-image"),r.append("format","json"),l.type.match(/image.*/)&&(r.append("image",l),a.ajax({type:"POST",data:r,contentType:!1,cache:!1,processData:!1,beforeSend:function(){t.prop("disabled",!0),i.find(".btn-hu-image-upload").attr("disabled","disabled");var e=a('<div class="hu-image-item-loader"><div class="progress" id="upload-image-progress"><div class="bar"></div></div></div>');i.find(".hu-image-upload-wrapper").addClass("loading").html(e)},success:function(e){var l=a.parseJSON(e);l.status?i.find(".hu-image-upload-wrapper").removeClass("loading").empty().html(l.output):i.find(".hu-image-upload-wrapper").removeClass("loading").empty();var r=i.find(".hu-image-upload-wrapper").find(">img");r.length?(a(".hu-image-field").removeClass("hu-image-field-empty").addClass("hu-image-field-has-image"),i.find("#jform_attribs_helix_ultimate_image").val(r.data("src"))):(a(".hu-image-field").removeClass("hu-image-field-has-image").addClass("hu-image-field-empty"),i.find("#jform_attribs_helix_ultimate_image").val("")),t.val(""),t.prop("disabled",!1),i.find(".btn-hu-image-upload").removeAttr("disabled")},xhr:function(){return myXhr=a.ajaxSettings.xhr(),myXhr.upload?myXhr.upload.addEventListener("progress",(function(e){a("#upload-image-progress").find(".bar").css("width",Math.floor(e.loaded/e.total*100)+"%")}),!1):alert("Uploadress is not supported."),myXhr},error:function(){i.find(".hu-image-upload-wrapper").empty(),t.val("")}})),t.val("")}))})),a(document).on("click",".btn-hu-image-remove",(function(e){e.preventDefault();var t=a(this).closest(".hu-image-field");if(1==confirm("You are about to delete this item permanently. 'Cancel' to stop, 'OK' to delete.")){var i={option:"com_ajax",helix:"ultimate",request:"task",action:"remove-blog-image",src:t.find(".sp-image-upload-wrapper").find(">img").data("src"),format:"json"};a.ajax({type:"POST",data:i,success:function(e){var i=a.parseJSON(e);i.status?(t.find(".hu-image-upload-wrapper").empty(),a(".hu-image-field").removeClass("hu-image-field-has-image").addClass("hu-image-field-empty"),t.find("#jform_attribs_helix_ultimate_image").val("")):alert(i.output)}})}})),a(".btn-hu-gallery-item-upload").on("click",(function(e){e.preventDefault(),a("#hu-gallery-item-upload").click()})),a("#hu-gallery-item-upload").on("change",(function(e){e.preventDefault();var t=a(this),l=a(this).prop("files");Joomla.getOptions("system.paths");for(i=0;i<l.length;i++){var r=l[i].name.split(".").pop().toLowerCase();if("png"==r||"jpg"==r||"jpeg"==r||"gif"==r||"svg"==r){let e="gallery-id-"+Math.floor(1e6*Math.random()+1);var o=new FormData;o.append("option","com_ajax"),o.append("helix","ultimate"),o.append("request","task"),o.append("action","upload-blog-image"),o.append("image",l[i]),o.append("index",e),o.append("gallery",!0),o.append("format","json"),a.ajax({type:"POST",data:o,contentType:!1,cache:!1,processData:!1,beforeSend:function(){var t=a('<li class="hu-gallery-item loading" id="'+e+'"><div class="progress"><div class="bar"></div></div></li>');a(".hu-gallery-items").append(t)},success:function(t){var i=a.parseJSON(t);i.status?a("#"+e).attr("data-src",i.data_src).removeClass("loading").empty().html(i.output):(a("#"+e).remove(),alert(i.output));let l=[];a(".hu-gallery-items").find(">.hu-gallery-item").each((function(e,t){l.push('"'+a(t).data("src")+'"')}));let r='{"helix_ultimate_gallery_images":['+l+"]}";a("#jform_attribs_helix_ultimate_gallery").val(r)},xhr:function(){return myXhr=a.ajaxSettings.xhr(),myXhr.upload?myXhr.upload.addEventListener("progress",(function(t){a("#"+e).find(".bar").css("width",Math.floor(t.loaded/t.total*100)+"%")}),!1):console.log("Uploadress is not supported."),myXhr}})}}t.val("")})),a(".hu-gallery-items").sortable({stop:function(e,t){let i=[];a(".hu-gallery-item").each((function(e,t){i.push('"'+a(t).data("src")+'"')}));let l='{"helix_ultimate_gallery_images":['+i+"]}";a("#jform_attribs_helix_ultimate_gallery").val(l)}}),a(document).on("click",".btn-hu-remove-gallery-image",(function(e){e.preventDefault();var t=a(this);if(1==confirm("You are about to delete this item permanently. 'Cancel' to stop, 'OK' to delete.")){var i={option:"com_ajax",helix:"ultimate",request:"task",action:"remove-blog-image",src:t.parent().data("src"),format:"json"};a.ajax({type:"POST",data:i,success:function(e){var i=a.parseJSON(e);if(i.status){t.parent().remove();let e=[];a(".hu-gallery-item").each((function(t,i){e.push('"'+a(i).data("src")+'"')}));let i='{"helix_ultimate_gallery_images":['+e+"]}";a("#jform_attribs_helix_ultimate_gallery").val(i)}else alert(i.output)}})}}))}));