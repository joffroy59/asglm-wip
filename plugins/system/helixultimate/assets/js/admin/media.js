/**
 * @package Helix Ultimate Framework
 * @author JoomShaper https://www.joomshaper.com
 * @copyright Copyright (c) 2010 - 2021 JoomShaper
 * @license http://www.gnu.org/licenses/gpl-2.0.html GNU/GPLv2 or Later
 */
jQuery((function(e){e(".hu-media-picker").on("click",(function(a){a.preventDefault();var t=this,i="id",o="";void 0!==e(this).data("id")?(i="id",o=e(this).data("id")):void 0!==e(this).data("target")&&(i="data",o=e(this).data("target")),e(this).helixUltimateModal({target_type:i,target:o});e.ajax({type:"POST",data:{action:"view-media",option:"com_ajax",helix:"ultimate",request:"task",format:"json"},beforeSend:function(){e(t).find(".fa").removeClass("fa-picture-o").addClass("fa-spinner fa-spin")},success:function(a){var i=e.parseJSON(a);e(t).find(".fa").removeClass("fa-spinner fa-spin").addClass("fa-picture-o"),i.status?(e(".hu-modal-breadcrumbs").html(i.breadcrumbs),e(".hu-modal-inner").html(i.output)):(e(".hu-modal-overlay, .hu-modal").remove(),e("body").addClass("hu-modal-open"),alert(i.output))},error:function(){alert("Somethings wrong, Try again")}})})),e(document).on("dblclick",".hu-media-folder",(function(a){a.preventDefault();var t={action:"view-media",option:"com_ajax",helix:"ultimate",request:"task",path:e(this).data("path"),format:"json"};e.ajax({type:"POST",data:t,beforeSend:function(){e(".hu-media-selected").removeClass("hu-media-selected"),e(".hu-modal-actions-left").hide(),e(".hu-modal-actions-right").show(),e(".hu-modal-inner").html('<div class="hu-modal-preloader"><span class="fas fa-circle-notch fa-pulse fa-spin fa-3x fa-fw" aria-hidden="true"></span></div>')},success:function(a){var t=e.parseJSON(a);t.status?(e(".hu-modal-breadcrumbs").html(t.breadcrumbs),e(".hu-modal-inner").html(t.output)):alert(t.output)},error:function(){alert("Somethings wrong, Try again")}})})),e(document).on("click",".hu-media-breadcrumb-item > a",(function(a){a.preventDefault();var t={action:"view-media",option:"com_ajax",helix:"ultimate",request:"task",path:e(this).data("path"),format:"json"};e.ajax({type:"POST",data:t,beforeSend:function(){e(".hu-modal-inner").html('<div class="hu-modal-preloader"><span class="fas fa-circle-notch fa-pulse fa-spin fa-3x fa-fw" aria-hidden="true"></span></div>')},success:function(a){var t=e.parseJSON(a);t.status?(e(".hu-modal-breadcrumbs").html(t.breadcrumbs),e(".hu-modal-inner").html(t.output)):alert(t.output)},error:function(){alert("Somethings wrong, Try again")}})})),e(document).on("click",".hu-media-folder, .hu-media-image",(function(a){a.preventDefault(),e(".hu-media-selected").removeClass("hu-media-selected"),e(this).addClass("hu-media-selected"),e(this).hasClass("hu-media-folder")?e(".hu-modal-action-select").hide():e(".hu-modal-action-select").removeAttr("style"),e(".hu-modal-actions-left").show(),e(".hu-modal-actions-right").hide()})),e(document).on("click",".hu-modal-action-select",(function(a){a.preventDefault();var t=e(".hu-media-selected").data("path"),i=e(".hu-media-selected").data("preview"),o=e(".hu-modal").attr("data-target");if("data"==e(".hu-modal").attr("data-target_type")){e(".hu-options-modal").find('[data-attrname="'+o+'"]').val(t).trigger("change");const a=document.querySelector(`.hu-options-modal [data-attrname=${o}]`);Joomla.utils.triggerEvent(a,"change"),e(".hu-options-modal").find('[data-attrname="'+o+'"]').prev(".hu-image-holder").html('<img src="'+i+'" alt="">');let d=e(".hu-options-modal").find('[data-attrname="'+o+'"]').siblings(".hu-media-clear");d.hasClass("hide")&&d.removeClass("hide")}else{e("#"+o).val(t).trigger("change"),Joomla.utils.triggerEvent(document.querySelector(`#${o}`),"change"),e("#"+o).prev(".hu-image-holder").html('<img src="'+i+'" alt="">');let a=e("#"+o).siblings(".hu-media-clear");a.hasClass("hide")&&a.removeClass("hide")}e(".hu-modal-overlay, .hu-modal").remove(),e("body").removeClass("hu-modal-open")})),e(document).on("click",".hu-modal-action-cancel",(function(a){a.preventDefault(),e(".hu-media-selected").removeClass("hu-media-selected"),e(".hu-modal-actions-left").hide(),e(".hu-modal-actions-right").show()})),e(document).on("click",".action-hu-modal-close",(function(a){a.preventDefault(),e(".hu-modal-overlay, .hu-modal").remove(),e("body").removeClass("hu-modal-open")})),e(document).on("click",".hu-media-clear",(function(a){a.preventDefault(),e(this).parent().find("input").val("").trigger("change"),Joomla.utils.triggerEvent(a.target.parentNode.querySelector("input"),"change"),e(this).parent().find(".hu-image-holder").empty(),e(this).hasClass("hide")||e(this).addClass("hide")})),e(document).on("click",".hu-modal-action-delete",(function(a){a.preventDefault();var t="file";if(e(".hu-media-selected").length){if(t=e(".hu-media-selected").hasClass("hu-media-folder")?"folder":"file",confirm("Are you sure you want to delete this "+t+"?")){var i={action:"delete-media",option:"com_ajax",helix:"ultimate",request:"task",type:t,path:e(".hu-media-selected").data("path"),format:"json"};e.ajax({type:"POST",data:i,success:function(a){var t=e.parseJSON(a);t.status?(e(".hu-media-selected").remove(),e(".hu-modal-actions-left").hide(),e(".hu-modal-actions-right").show()):alert(t.message)},error:function(){alert("Somethings wrong, Try again")}})}}else alert("Please select a file or directory first to delete.")})),e(document).on("click",".hu-modal-action-new-folder",(function(a){a.preventDefault();var t=prompt("Please enter the name of the directory which should be created.");if(null==t||""==t);else{var i={action:"create-folder",option:"com_ajax",helix:"ultimate",request:"task",folder_name:t,path:e(".hu-media-breadcrumb-item.active").data("path"),format:"json"};e.ajax({type:"POST",data:i,success:function(a){var t=e.parseJSON(a);t.status?e(".hu-modal-inner").html(t.output):alert(t.message)},error:function(){alert("Somethings wrong, Try again")}})}})),e.fn.uploadMedia=function(a){a=e.extend({data:"",index:""},a);e.ajax({type:"POST",url:"index.php?option=com_ajax&helix=ultimate&request=task&action=upload-media&format=json&helix_id="+helixUltimateStyleId,data:a.data,contentType:!1,cache:!1,processData:!1,beforeSend:function(){var t='<li class="hu-media-progress '+a.index+'">';t+='<div class="hu-media-thumb">',t+='<div class="hu-progress"><div class="hu-progress-bar"></div></div>',t+="</div>",t+='<div class="hu-media-label"><span class="fas fa-circle-notch fa-spin" aria-hidden="true"></span> <span class="hu-media-upload-percentage"></span>Uploading...</div>',t+="</li>",e("#hu-media-manager").animate({scrollTop:e("#hu-media-manager").prop("scrollHeight")},1e3),e(".hu-media").append(t)},success:function(t){var i=e.parseJSON(t);i.status?e("."+a.index).removeClass().addClass("hu-media-image").attr("data-path",i.path).attr("data-preview",i.src).html(i.output):(e("."+a.index).remove(),alert(i.message))},xhr:function(){return myXhr=e.ajaxSettings.xhr(),myXhr.upload?myXhr.upload.addEventListener("progress",(function(t){e("."+a.index).find(".hu-progress-bar").css("width",Math.floor(t.loaded/t.total*100)+"%"),e("."+a.index).find(".hu-media-upload-percentage").text(Math.floor(t.loaded/t.total*100)+"% ")}),!1):alert("Uploadress is not supported."),myXhr}})},e(document).on("click",".hu-modal-action-upload",(function(a){a.preventDefault(),e("#hu-file-input").click()})),e(document).on("change","#hu-file-input",(function(a){a.preventDefault();var t=e(this),o=e(this).prop("files");for(i=0;i<o.length;i++){var d=o[i].name.split(".").pop();if("png"==d||"jpg"==d||"jpeg"==d||"gif"==d||"svg"==d||"ico"==d){var n=new FormData;n.append("file",o[i]),n.append("path",e(".hu-media-breadcrumb-item.active").data("path")),n.append("index","media-id-"+Math.floor(1e6*Math.random()+1)),e(this).uploadMedia({data:n,index:"media-id-"+Math.floor(1e6*Math.random()+1)})}}t.val("")}))}));