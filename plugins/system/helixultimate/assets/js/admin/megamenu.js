var megaMenu={run(){this.declareDOMVariables(),this.initMiniColors(),this.jQueryPluginExtension(),this.initChosen(),this.removeEventListeners(),this.handleMegaMenuToggle(),this.toggleSidebarSettings($megamenu.prop("checked")),this.handleSidebarSettings(),this.handleCloseModal(),this.rowSortable(".hu-megamenu-rows-container"),this.columnSortable(".hu-megamenu-columns-container"),this.itemSortable(".hu-megamenu-column-contents"),this.handleSaveMegaMenuSettings(),this.handleRemoveRow(),this.handleLoadSlots(),this.handleCustomLayoutDisplay(),this.handleLayoutOptionSelection(),this.handleCustomLayoutSelection(),this.handleRowWiseColumnLayoutSelection(),this.openModulePopover(),this.handleClosePopover(),this.handleAddNewCell(),this.handleRemoveCell(),this.toggleColumnsSlots(),this.handleModuleSearch()},jQueryPluginExtension(){$.fn.extend({test(){return this.css("color","#fff")}})},initChosen(){$("select[data-husearch]").chosen({width:"100%",allow_single_deselect:!0,placeholder_text_single:Joomla.Text._("HELIX_ULTIMATE_SELECT_ICON_LABEL")})},declareDOMVariables(){$megamenu=$(".hu-megamenu-builder-megamenu"),$settingsInput=$("#hu-megamenu-layout-settings"),$saveBtn=$(".hu-megamenu-save-btn"),$cancelBtn=$(".hu-megamenu-cancel-btn"),$rowsContainer=$(".hu-megamenu-rows-container"),$popover=$(".hu-megamenu-popover");itemId=$("#hu-menu-itemid").val(),settingsData=$settingsInput.val(),settingsData=settingsData&&JSON.parse(settingsData),settingsData=$.extend({badge:"",badge_bg_color:"",badge_position:"",badge_text_color:"",customclass:"",dropdown:"right",faicon:"",layout:[],megamenu:0,menualign:"full",showtitle:1,width:"600px"},settingsData),baseUrl=$("#hu-base-url").val()},handleRemoveCell(){$(document).on("click",".hu-megamenu-cell-remove",(function(){const e=$(this).closest(".hu-megamenu-cell").data("cellid")||1,t=$(this).closest(".hu-megamenu-col").data("columnid")||1,a=$(this).closest(".hu-megamenu-row-wrapper").data("rowid")||1;$(this).closest(".hu-megamenu-cell").slideUp((function(){$(this).remove();let o=settingsData.layout[a-1].attr[t-1],n=void 0!==o.items?o.items:[];n.length>0&&n.splice(e-1,1),settingsData.layout[a-1].attr[t-1].items=n}))}))},handleAddNewCell(){const e=this;$(document).on("click",".hu-megamenu-insert-module",(async function(){const t=$(this).data("module"),a="module",o=$popover.data("rowid"),n=$popover.data("columnid"),s=settingsData.layout[o-1].attr[n-1]||{items:[]};void 0===s.items&&(s.items=[]);const l={type:a,item_id:t,itemId:itemId,rowId:o,columnId:n,cellId:s.items.length+1},u=await e.addNewCell(l);u.status&&($(`.hu-megamenu-row-wrapper[data-rowid=${o}] .hu-megamenu-col[data-columnid=${n}] .hu-megamenu-column-contents`).append(u.html),e.closePopover(),s.items.push({type:a,item_id:t}),settingsData.layout[o-1].attr[n-1]=s)}))},addNewCell(e){let t=`${baseUrl}/administrator/index.php?option=com_ajax&helix=ultimate&request=task&action=generateNewCell&helix_id=${helixUltimateStyleId}`;return new Promise(((a,o)=>{$.ajax({method:"POST",url:t,data:e,success(e){e="string"==typeof e&&e.length>0&&JSON.parse(e),a(e)},error(e){o(e)}})}))},handleClosePopover(){const e=this;$(document).on("click",".hu-megamenu-popover-close",(function(){e.closePopover()}))},openPopover(){!$popover.hasClass("show")&&$popover.addClass("show"),$(".hu-megamenu-module-search").val("")},closePopover(){$popover.hasClass("show")&&$popover.removeClass("show")},openModulePopover(){const e=this;$(document).on("click",".hu-megamenu-add-new-item",(async function(t){const a=$(this).closest(".hu-megamenu-col").data("columnid")||1,o=$(this).closest(".hu-megamenu-row-wrapper").data("rowid")||1;$popover.data("rowid",o).data("columnid",a).attr("data-rowid",o).attr("data-columnid",a);const n=await e.getModulesContents();n.status&&$popover.find(".hu-megamenu-modules-container").html(n.html),e.openPopover()}))},handleModuleSearch(){let e=null,t=this;$(document).on("keyup",".hu-megamenu-module-search",(function(a){a.preventDefault(),e&&clearTimeout(e),e=setTimeout((async()=>{let{value:e}=a.target;const o=await t.getModulesContents(e);o.status&&$popover.find(".hu-megamenu-modules-container").html(o.html)}),100)}))},getModulesContents(e=""){const t=`${baseUrl}/administrator/index.php?option=com_ajax&helix=ultimate&request=task&action=getModuleList&keyword=${e}&helix_id=${helixUltimateStyleId}`;return new Promise(((e,a)=>{$.ajax({method:"GET",url:t,success(t){t="string"==typeof t&&t.length>0&&JSON.parse(t),e(t)},error(e){a(e)}})}))},initMiniColors(){$(".hu-input-color").each((function(){!$(this).hasClass("minicolors")&&$(this).addClass("minicolors")})),Joomla.initColorPicker(".hu-megamenu-container .minicolors")},handleMegaMenuToggle(){let e=this;$megamenu.on("change",(function(t){t.preventDefault(),e.toggleSidebarSettings($(this).prop("checked"))}))},toggleSidebarSettings(e){let t=$(".hu-megamenu-grid"),a=$(".hu-megamenu-settings"),o=$(".hu-megamenu-alignment"),n=$(".hu-menuitem-dropdown-position"),s=$(".hu-mega-menu-builder");e?(a.hasClass("show")||a.addClass("show"),t.hasClass("show")||t.addClass("show"),s.hasClass("collapsed")&&s.removeClass("collapsed"),o.show(),n.hide()):(a.hasClass("show")&&a.removeClass("show"),t.hasClass("show")&&t.removeClass("show"),s.hasClass("collapsed")||s.addClass("collapsed"),o.hide(),n.show())},handleCustomLayoutDisplay(){$(document).on("click",".hu-megamenu-custom",(function(){$(this).closest(".hu-megamenu-columns-layout").find(".hu-megamenu-custom-layout").slideToggle(100)}))},closeRowLayoutDisplay(){let e=$(".hu-megamenu-row-slots");e.hasClass("show")&&e.removeClass("show")},closeLayoutDisplay(){$(".hu-megamenu-add-slots").hide()},removeEventListeners(){$(document).off("click",".hu-megamenu-add-slots .hu-megamenu-custom-layout-apply"),$(document).off("click",".hu-megamenu-remove-row"),$(document).off("click",".hu-megamenu-add-row > a"),$(document).off("click",".hu-megamenu-custom"),$(document).off("click",".hu-megamenu-columns"),$(document).off("click",".hu-megamenu-add-new-item"),$(document).off("click",".hu-megamenu-cell-options-item"),$(document).off("click",".hu-megamenu-popover-close"),$(document).off("click",".hu-megamenu-insert-module"),$(document).off("click",".hu-megamenu-cell-remove"),$(document).off("click",".hu-megamenu-add-slots .hu-megamenu-column-layout:not(.hu-megamenu-custom)"),$(document).off("click",".hu-megamenu-row-slots .hu-megamenu-column-layout:not(.hu-megamenu-custom)"),$(document).off("click",".hu-megamenu-row-slots .hu-megamenu-custom-layout-apply"),$cancelBtn.off("click"),$saveBtn.off("click"),$megamenu.off("change")},handleRowWiseColumnLayoutSelection(){const e=this;$(document).on("click",".hu-megamenu-row-slots .hu-megamenu-column-layout:not(.hu-megamenu-custom)",(async function(){const t=$(this).closest(".hu-megamenu-row-wrapper").data("rowid")-1,a=$(this).data("layout")||"12";await e.changeRowsColumns({rowIndex:t,layout:a,$container:$(this).closest(".hu-megamenu-row-wrapper").find(".hu-megamenu-columns-container")})})),$(document).on("click",".hu-megamenu-row-slots .hu-megamenu-custom-layout-apply",(async function(){const t=$(this).closest(".hu-megamenu-row-wrapper").data("rowid")-1,a=$(this).parent().find(".hu-megamenu-custom-layout-field").val();await e.changeRowsColumns({rowIndex:t,layout:a,$container:$(this).closest(".hu-megamenu-row-wrapper").find(".hu-megamenu-columns-container")})}))},async changeRowsColumns({rowIndex:e,layout:t,$container:a}){const o=settingsData.layout[e],n=await this.updateRowLayout({layout:t,rowData:JSON.stringify(o),rowId:e+1,itemId:itemId});n.status&&(a.html(n.html),settingsData.layout[e]=n.data,this.closeRowLayoutDisplay(),this.refreshSortable(["item"]))},updateRowLayout:({layout:e,rowData:t,rowId:a,itemId:o})=>new Promise(((n,s)=>{const l=`${baseUrl}/administrator/index.php?option=com_ajax&helix=ultimate&request=task&action=updateRowLayout&helix_id=${helixUltimateStyleId}`,u={layout:e,data:t,rowId:a,itemId:o};$.ajax({method:"POST",url:l,data:u,success(e){e=!("string"!=typeof e||!e.length)&&JSON.parse(e),n(e)},error(e){s(e)}})})),handleLayoutOptionSelection(){let e=this;$(document).on("click",".hu-megamenu-add-slots .hu-megamenu-column-layout:not(.hu-megamenu-custom)",(async function(t){t.preventDefault();const a=$(this).data("layout")||"12",o=settingsData.layout.length+1,n=await e.generateRow(a,o,itemId);n.status&&($rowsContainer.append(n.data),e.closeLayoutDisplay(),settingsData.layout.push(n.row),e.refreshSortable(["column","item"]))}))},handleCustomLayoutSelection(){let e=this;$(document).on("click",".hu-megamenu-add-slots .hu-megamenu-custom-layout-apply",(async function(t){t.preventDefault();let a=$(".hu-megamenu-custom-layout-field").val(),o=settingsData.layout.length+1;if(""==a)return;const n=await e.generateRow(a,o,itemId);n.status&&($rowsContainer.append(n.data),e.closeLayoutDisplay(),settingsData.layout.push(n.row),e.refreshSortable())}))},toggleColumnsSlots(){$(document).on("click",".hu-megamenu-columns",(function(){$(this).closest(".hu-megamenu-row-toolbar-right").find(".hu-megamenu-row-slots").toggleClass("show")}))},generateRow:(e,t,a)=>new Promise(((o,n)=>{const s=`${baseUrl}/administrator/index.php?option=com_ajax&helix=ultimate&request=task&action=generateRow&helix_id=${helixUltimateStyleId}`,l={layout:e,rowId:t,itemId:a};$.ajax({method:"POST",url:s,data:l,success(e){e=!("string"!=typeof e||!e.length)&&JSON.parse(e),o(e)},error(e){n(e)}})})),handleSidebarSettings(){let e=this;[".hu-megamenu-sidebar [name=megamenu]",".hu-megamenu-sidebar [name=width]",".hu-megamenu-sidebar [name=dropdown]",".hu-megamenu-sidebar [name=showtitle]",".hu-megamenu-sidebar [name=menualign]",".hu-megamenu-sidebar [name=faicon]",".hu-megamenu-sidebar [name=customclass]",".hu-megamenu-sidebar [name=badge]",".hu-megamenu-sidebar [name=badge_position]",".hu-megamenu-sidebar [name=badge_bg_color]",".hu-megamenu-sidebar [name=badge_text_color]"].forEach((t=>{$(t).on("change",(function(t){t.preventDefault();let{name:a,value:o}=t.target;o="checkbox"===$(this).attr("type")?($(this).prop("checked")>>0).toString():o,e.updateSettingsField(a,o)}))}))},swapRow(e,t){let a=settingsData.layout,o=a.splice(e,1);a.splice(t,0,o[0]),settingsData.layout=a},swapColumn(e,t,a){let o=settingsData.layout[e].attr,n=o.splice(t,1);o.splice(a,0,n[0]),settingsData.layout[e].attr=o},swapItem({prevRowIndex:e,prevColIndex:t,prevItemIndex:a,currRowIndex:o,currColIndex:n,currItemIndex:s}){let l=[...settingsData.layout[e].attr[t].items],u=l.splice(a,1);settingsData.layout[e].attr[t].items=l;let i=settingsData.layout[o].attr[n];void 0===i.items&&(i.items=[]);let m=[...i.items];0===m.length?m.push(u[0]):m.splice(s,0,u[0]),i.items=m,settingsData.layout[o].attr[n]=i},updateSettings(){$settingsInput.val(JSON.stringify(settingsData))},updateSettingsField(e,t){settingsData[e]=t},handleRemoveRow(){$(document).on("click",".hu-megamenu-remove-row",(function(e){e.preventDefault();let t=$(this).closest(".hu-megamenu-row-wrapper"),a=t.index();t.slideUp(100,(function(){$(this).remove(),settingsData.layout.splice(a,1)}))}))},handleLoadSlots(){$(document).on("click",".hu-megamenu-add-row > a",(function(){$(this).closest(".hu-megamenu-grid").find(".hu-megamenu-add-slots").toggle()}))},handleCloseModal(){$cancelBtn.on("click",(function(){$(this).closeModal()}))},handleSaveMegaMenuSettings(){let e=this;$saveBtn.on("click",(function(){e.saveMegaMenuSettings()}))},saveMegaMenuSettings(){const e=`${baseUrl}/administrator/index.php?option=com_ajax&helix=ultimate&request=task&action=saveMegaMenuSettings&helix_id=${helixUltimateStyleId}`,t={settings:settingsData,id:itemId};$.ajax({method:"POST",url:e,data:t,success(e){(e="string"==typeof e&&e.length>0&&JSON.parse(e)).status&&Joomla.reloadPreview()},error(e){alert("Something went wrong!")},complete(){$(document).closeModal(),Joomla.HelixToaster.success("Saved mega menu settings!","Success")}})},refreshSortable(e){e||(e=["row","column","item"]),"string"==typeof e&&(e=[e]);const t={row:{selector:".hu-megamenu-rows-container",func:"rowSortable"},column:{selector:".hu-megamenu-columns-container",func:"columnSortable"},item:{selector:".hu-megamenu-column-contents",func:"itemSortable"}};for(let a=0;a<e.length;a++)if(void 0!==t[e[a]]){let o=t[e[a]];this[o.func](o.selector)}},updateRows(){$(".hu-megamenu-row-wrapper").each((function(e){$(this).data("rowid",e+1).attr("data-rowid",e+1)}))},rowSortable(e){let t=this,a=null,o=null;$(e).sortable({handle:".hu-megamenu-row-drag-handlers",placeholder:"hu-row-sortable-placeholder",axis:"y",items:"> *",tolerance:"pointer",scroll:!0,start(e,t){let o=t.helper.outerHeight();o-=2,t.placeholder.css({height:o}),a=t.item.index()},stop(e,n){o=n.item.index(),t.swapRow(a,o),t.updateRows()}}).disableSelection()},updateColumns(e){$(`.hu-megamenu-row-wrapper[data-rowid=${e+1}]`).find(".hu-megamenu-col").each((function(e){$(this).data("columnid",e+1).attr("data-columnid",e+1)}))},columnSortable(e){let t,a,o,n,s=this;$(e).sortable({handle:".hu-megamenu-column-drag-handler",placeholder:"hu-column-sortable-placeholder",containment:".hu-megamenu-grid",axis:"x",items:"> *",start(e,a){let s=a.helper.outerHeight(),l=a.helper.outerWidth();a.placeholder.css({height:s,width:l}),o=a.item.closest(".hu-megamenu-row-wrapper").data("rowid")-1,t=a.item.index(),n=a.item.closest(".hu-megamenu-columns-container"),n.addClass("hu-megamenu-column-dragging")},stop(e,l){a=l.item.index(),s.swapColumn(o,t,a),s.updateColumns(o),n.removeClass("hu-megamenu-column-dragging")}})},itemSortable(e){let t,a,o,n,s,l,u,i=this;$(e).sortable({connectWith:".hu-megamenu-column-contents",placeholder:"hu-item-sortable-placeholder",containment:".hu-megamenu-grid",items:"> .hu-megamenu-cell",start(e,t){let a=t.helper.outerHeight(),l=t.helper.outerWidth();t.placeholder.css({height:a,width:l}),n=(t.item.closest(".hu-megamenu-col").data("columnid")||1)-1,o=(t.item.closest(".hu-megamenu-row-wrapper").data("rowid")||1)-1,s=t.item.index(),u=t.item.find(".hu-megamenu-cell-remove"),u.css({opacity:0})},stop(e,m){a=(m.item.closest(".hu-megamenu-col").data("columnid")||1)-1,t=(m.item.closest(".hu-megamenu-row-wrapper").data("rowid")||1)-1,l=m.item.index(),i.swapItem({prevRowIndex:o,prevColIndex:n,prevItemIndex:s,currRowIndex:t,currColIndex:a,currItemIndex:l}),u.css({opacity:1})}}).disableSelection()}};Joomla.helixMegaMenu=megaMenu;