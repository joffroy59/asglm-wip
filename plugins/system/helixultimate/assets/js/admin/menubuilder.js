jQuery((function(e){const t=Joomla.getOptions("meta")||{};var a=null,n=null,o=e("select[name=menu]").val()||"mainmenu";function i(){e(document).off("click",".hu-add-menu-item")}function s(a){const n=`${t.base}/administrator/index.php?option=com_ajax&helix=ultimate&request=task&action=getMenuItems&menutype=${a}&helix_id=${helixUltimateStyleId}`;e.ajax({type:"GET",url:n,beforeSend(){e(document).off("click",".hu-branch-tools .hu-branch-tools-icon")},success(a){(a=a&&JSON.parse(a)).status&&(e("#hu-menu-builder-container").html(a.data),i(),Joomla.sortable.run(),e(document).on("sortCompleted",(async function(a,n){let o=n.item.data("itemid"),i=n.item.data("parent"),s=n.item.getParent(),l=s.length?s.data("itemid"):1;var r;+i==+l?u(s,!0):(await(r={id:o,parent:l},new Promise((function(a,n){const o=`${t.base}/administrator/index.php?option=com_ajax&helix=ultimate&request=task&action=parentAdoption&helix_id=${helixUltimateStyleId}`;e.ajax({method:"POST",url:o,data:r,success(e){e="string"==typeof e&&e.length>0?JSON.parse(e):e,a(e)},error(e){n(e)}})})))).status&&(n.item.data("parent",l).attr("data-parent",l),u(s))})),e(document).on("click",".hu-branch-tools .hu-branch-tools-icon",(function(t){t.preventDefault();let a=this;e(".hu-branch-tools .hu-branch-tools-list").each((function(){e(this).hasClass("active")&&e(this)[0]!==e(a).next(".hu-branch-tools-list")[0]&&(e(this).removeClass("active"),e(this).fadeIn())})),e(this).next(".hu-branch-tools-list").toggleClass("active").fadeToggle()})),e(document).on("click",".hu-branch-tools .hu-branch-tools-list-edit",(function(t){t.preventDefault(),r(),c(e(this).closest(".hu-menu-tree-branch").data("itemid")||0)})),e(document).on("click",".hu-branch-tools .hu-branch-tools-list-delete",(function(t){t.preventDefault(),r();const a=e(this).closest(".hu-menu-tree-branch").data("itemid")||0;window.confirm("Are you sure to delete the item?")&&l(a)})),e(document).on("click",".hu-branch-tools .hu-branch-tools-list-megamenu",(async function(a){a.preventDefault(),r();const n=e(this).closest(".hu-menu-tree-branch"),o=n.data("parent")||1,i=n.data("itemid")||0,s=await function(a){return new Promise(((n,o)=>{const i=`${t.base}/administrator/index.php?option=com_ajax&helix=ultimate&request=task&action=generateMegaMenuBody&id=${a}&helix_id=${helixUltimateStyleId}`;e.ajax({method:"GET",url:i,success(e){e="string"==typeof e&&e.length>0&&JSON.parse(e),n(e)},error(e){o(e)}})}))}(i);s.status&&(e(document).helixUltimateMegamenuModal({title:"1"==o?"Mega Menu":"Settings",className:"hu-mega-menu-builder",targetType:"id",target:"megaMenuModal",body:s.html}),Joomla.helixMegaMenu.run())})))},complete(){Joomla.reloadPreview(),Joomla.utils.calculateSiblingDistances()}})}function i(){e(document).off("click",".hu-branch-tools .hu-branch-tools-list-delete"),e(document).off("click",".hu-branch-tools .hu-branch-tools-list-edit"),e(document).off("click",".hu-branch-tools .hu-branch-tools-list-megamenu")}function l(a){const n=`${t.base}/administrator/index.php?option=com_menus&task=items.trash&cid[]=${a}`;e.ajax({method:"GET",url:n,success(e){s(o)},error(e){Joomla.HelixToaster.error("Something went wrong!","Error")},complete(){!function(){const a=`${t.base}/administrator/index.php?option=com_ajax&helix=ultimate&request=task&action=rebuildMenu&helix_id=${helixUltimateStyleId}`;e.ajax({method:"GET",url:a,success(e){},error(e){alert("Rebuild menu failed with: "+e.message)}})}(),Joomla.HelixToaster.error("Menu item has been successfully removed!","Success")}})}function r(){e(".hu-branch-tools .hu-branch-tools-list").each((function(){e(this).hasClass("active")&&(e(this).removeClass("active"),e(this).hide())}))}function c(e){m({title:"Edit Menu Item",targetType:"id",target:"editMenuItem",className:"edit-menu-item",frameUrl:t.base+"/administrator/index.php?option=com_menus&task=item.edit&tmpl=component&menutype="+o+"&id="+e}),h("edit-menu-item","item.save")}function u(a,n=!1){let o=a.length?a.getChildren():e(document).getRootChildren();if(0===o.length)return;const i={cid:[],order:[]};var s;o.each((function(t){i.cid.push(e(this).data("itemid")),i.order.push(t+1)})),(s=i,new Promise((function(a,n){const o=`${t.base}/administrator/index.php?option=com_menus&view=items&task=items.saveOrderAjax&tmpl=component`;e.ajax({method:"POST",url:o,data:s,success(e){a(e)},error(e){n(e)}})}))).then((function(){Joomla.reloadPreview()}))}function m({title:t,targetType:o,target:i,className:s,frameUrl:l}){e(document).helixUltimateFrameModal({title:t,targetType:o,target:i,className:s,frameUrl:l}),a=e(`.hu-modal.${s}`),(n=a.find("iframe")).off("load"),e(document).off("click",`.hu-modal.${s} button.hu-save-btn`),a.find(".hu-save-btn").prop("disabled",!0),a.find(".hu-cancel-btn").on("click",(function(t){e(this).closeModal()}))}function d(t){const a=e(".hu-spinner");t?a.hasClass("hidden")&&a.removeClass("hidden"):a.hasClass("hidden")||a.addClass("hidden")}function h(t,a="item.apply"){const i=`.hu-modal.${t} button.hu-save-btn`;n.on("load",(function(){const t=n.contents();e(i).prop("disabled",!1),e(document).off("click",i),e(document).on("click",i,Joomla.utils.debounce((async function(){const n=e(t).find("form");n.find("input[name=task]").val(a),n.find("input[name=task]").attr("value",a);const i=t[0].formvalidator.isValid(n[0]);if(d(!0),i)try{const t=await function(t){const a=t.attr("action"),n=t.serializeArray();return new Promise(((t,o)=>{e.ajax({method:"POST",url:a,data:n,success(e){t(e)},error(e){o(e)}})}))}(n),i=e('<div class="hu-menuitem-resp"></div>').hide().html(t),l=i.find(".alert-heading"),r=i.find(".alert-message"),c=l.length>0?l.text():"",u=r.length>0?r.text():"",m=i.find("#system-message-container noscript"),h=e("<div></div>").hide().html(m.text());if(h.find(".alert-danger").length>0)return Joomla.HelixToaster.error(m.html(),"Error"),void d(!1);t&&"Error"!==c?(s(o),e(this).closeModal(),"item.apply"===a?Joomla.HelixToaster.success("Menu item has been successfully added!","Saved"):"item.save"===a&&Joomla.HelixToaster.success("Changes have been successfully saved!","Updated")):Joomla.HelixToaster.error(u,"Error"),d(!1)}catch(e){Joomla.HelixToaster.error("Something went wrong!","Error"),d(!1)}else d(!1)}),500))}))}s(o),e("select[name=menu]").on("change",(function(){s(o=e(this).val())})),e(document).on("click",".hu-add-menu-item",(function(e){e.preventDefault(),m({title:"Add New Item",targetType:"id",target:"addNewMenuItem",className:"add-new-menu-item",frameUrl:t.base+"/administrator/index.php?option=com_menus&task=item.add&tmpl=component&menutype="+o}),h("add-new-menu-item","item.apply")})),i()}));